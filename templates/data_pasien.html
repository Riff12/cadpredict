<!DOCTYPE html>
<html lang="id">
<head>
    <title>Data Pasien - Arteriku</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Include DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
    <style>
        /* Ensures table columns don't overflow */
        .header-gradient {
            background: linear-gradient(to right, #8F5099, #CB8ED6);
            color: white;
        }
        .btn-gradient-header:hover {
            filter: brightness(1.1);
        }
        th, td {
            max-width: 200px; /* Adjust the width of the columns as necessary */
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* Enables horizontal scrolling */
        .table-responsive {
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="p-3 header-gradient">
        <div class="container-fluid">
            <div class="d-flex flex-wrap align-items-center justify-content-between">
                <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
                    <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap"><use xlink:href="#bootstrap"/></svg>
                    <span class="fs-4">Arteriku</span>
                </a>
                <ul class="nav col-12 col-lg-auto mb-2 justify-content-center mb-md-0">
                    <li><a href="/" class="btn btn-gradient-header">Home</a></li>
                    <li><a href="/predict" class="btn btn-gradient-header">Mulai</a></li>
                    <li><a href="/data_pasien" class="btn btn-gradient-header">Data Pasien</a></li>
                </ul>
            </div>
        </div>
    </header>

    <main class="container mt-5">
        <h2 class="text-center">Riwayat Data Pasien</h2>
        <p class="text-center">Tabel ini menampilkan riwayat data input dari form prediksi CAD, sebagai baseline untuk perbandingan dengan model quantum.</p>
        <div class="row mb-3">
            <div class="col-md-6">
                <input type="text" id="searchInput" class="form-control" placeholder="Search...">
            </div>
            <div class="col-md-6">
                <select id="filterSelect" class="form-select">
                    <option value="">Filter by Prediction: Semua</option>
                    <option value="Cad (Penyakit Arteri Koroner)">Cad</option>
                    <option value="Normal">Normal</option>
                </select>
            </div>
        </div>

        <!-- Table with DataTables and responsive container -->
        <div class="table-responsive">
            <table id="patientTable" class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Age</th>
                        <th>Weight</th>
                        <th>Length</th>
                        <th>Sex</th>
                        <th>BMI</th>
                        <th>DM</th> <!-- Perbaikan: Ganti HTN pertama dengan DM sesuai app.py -->
                        <th>HTN</th>
                        <th>Current Smoker</th>
                        <th>EX-Smoker</th>
                        <th>FH</th>
                        <th>Obesity</th>
                        <th>CRF</th>
                        <th>CVA</th>
                        <th>Airway disease</th>
                        <th>Thyroid Disease</th>
                        <th>CHF</th>
                        <th>DLP</th>
                        <th>BP</th>
                        <th>PR</th>
                        <th>Edema</th>
                        <th>Weak Peripheral Pulse</th>
                        <th>Lung rales</th>
                        <th>Systolic Murmur</th>
                        <th>Diastolic Murmur</th>
                        <th>Typical Chest Pain</th>
                        <th>Dyspnea</th>
                        <th>Function Class</th>
                        <th>Atypical</th>
                        <th>Nonanginal</th>
                        <th>Exertional CP</th>
                        <th>LowTH Ang</th>
                        <th>Q Wave</th>
                        <th>St Elevation</th>
                        <th>St Depression</th>
                        <th>Tinversion</th>
                        <th>LVH</th>
                        <th>Poor R Progression</th>
                        <th>FBS</th>
                        <th>CR</th>
                        <th>TG</th>
                        <th>LDL</th>
                        <th>HDL</th>
                        <th>BUN</th>
                        <th>ESR</th>
                        <th>HB</th>
                        <th>K</th>
                        <th>Na</th>
                        <th>WBC</th>
                        <th>Lymph</th>
                        <th>Neut</th>
                        <th>PLT</th>
                        <th>EF-TTE</th>
                        <th>Region RWMA</th>
                        <th>VHD</th>
                        <th>Prediction</th>
                        <th>Prob Cad (%)</th>
                    </tr>
                </thead>
                <tbody>
                    {% if patient_data %}
                        {% for data in patient_data %}
                        <tr>
                            <td>{{ data['Age'][0] if data['Age'] else 'N/A' }}</td>
                            <td>{{ data['Weight'][0] if data['Weight'] else 'N/A' }}</td>
                            <td>{{ data['Length'][0] if data['Length'] else 'N/A' }}</td>
                            <td>{{ data['Sex'][0] if data['Sex'] else 'N/A' }}</td>
                            <td>{{ data['BMI'][0] if data['BMI'] else 'N/A' }}</td>
                            <td>{{ data['DM'][0] if data['DM'] else 'N/A' }}</td> <!-- Perbaikan: Ganti HTN dengan DM -->
                            <td>{{ data['HTN'][0] if data['HTN'] else 'N/A' }}</td>
                            <td>{{ data['Current Smoker'][0] if data['Current Smoker'] else 'N/A' }}</td>
                            <td>{{ data['EX-Smoker'][0] if data['EX-Smoker'] else 'N/A' }}</td>
                            <td>{{ data['FH'][0] if data['FH'] else 'N/A' }}</td>
                            <td>{{ data['Obesity'][0] if data['Obesity'] else 'N/A' }}</td>
                            <td>{{ data['CRF'][0] if data['CRF'] else 'N/A' }}</td>
                            <td>{{ data['CVA'][0] if data['CVA'] else 'N/A' }}</td>
                            <td>{{ data['Airway disease'][0] if data['Airway disease'] else 'N/A' }}</td>
                            <td>{{ data['Thyroid Disease'][0] if data['Thyroid Disease'] else 'N/A' }}</td>
                            <td>{{ data['CHF'][0] if data['CHF'] else 'N/A' }}</td>
                            <td>{{ data['DLP'][0] if data['DLP'] else 'N/A' }}</td>
                            <td>{{ data['BP'][0] if data['BP'] else 'N/A' }}</td>
                            <td>{{ data['PR'][0] if data['PR'] else 'N/A' }}</td>
                            <td>{{ data['Edema'][0] if data['Edema'] else 'N/A' }}</td>
                            <td>{{ data['Weak Peripheral Pulse'][0] if data['Weak Peripheral Pulse'] else 'N/A' }}</td>
                            <td>{{ data['Lung rales'][0] if data['Lung rales'] else 'N/A' }}</td>
                            <td>{{ data['Systolic Murmur'][0] if data['Systolic Murmur'] else 'N/A' }}</td>
                            <td>{{ data['Diastolic Murmur'][0] if data['Diastolic Murmur'] else 'N/A' }}</td>
                            <td>{{ data['Typical Chest Pain'][0] if data['Typical Chest Pain'] else 'N/A' }}</td>
                            <td>{{ data['Dyspnea'][0] if data['Dyspnea'] else 'N/A' }}</td>
                            <td>{{ data['Function Class'][0] if data['Function Class'] else 'N/A' }}</td>
                            <td>{{ data['Atypical'][0] if data['Atypical'] else 'N/A' }}</td>
                            <td>{{ data['Nonanginal'][0] if data['Nonanginal'] else 'N/A' }}</td>
                            <td>{{ data['Exertional CP'][0] if data['Exertional CP'] else 'N/A' }}</td>
                            <td>{{ data['LowTH Ang'][0] if data['LowTH Ang'] else 'N/A' }}</td>
                            <td>{{ data['Q Wave'][0] if data['Q Wave'] else 'N/A' }}</td>
                            <td>{{ data['St Elevation'][0] if data['St Elevation'] else 'N/A' }}</td>
                            <td>{{ data['St Depression'][0] if data['St Depression'] else 'N/A' }}</td>
                            <td>{{ data['Tinversion'][0] if data['Tinversion'] else 'N/A' }}</td>
                            <td>{{ data['LVH'][0] if data['LVH'] else 'N/A' }}</td>
                            <td>{{ data['Poor R Progression'][0] if data['Poor R Progression'] else 'N/A' }}</td>
                            <td>{{ data['FBS'][0] if data['FBS'] else 'N/A' }}</td>
                            <td>{{ data['CR'][0] if data['CR'] else 'N/A' }}</td>
                            <td>{{ data['TG'][0] if data['TG'] else 'N/A' }}</td>
                            <td>{{ data['LDL'][0] if data['LDL'] else 'N/A' }}</td>
                            <td>{{ data['HDL'][0] if data['HDL'] else 'N/A' }}</td>
                            <td>{{ data['BUN'][0] if data['BUN'] else 'N/A' }}</td>
                            <td>{{ data['ESR'][0] if data['ESR'] else 'N/A' }}</td>
                            <td>{{ data['HB'][0] if data['HB'] else 'N/A' }}</td>
                            <td>{{ data['K'][0] if data['K'] else 'N/A' }}</td>
                            <td>{{ data['Na'][0] if data['Na'] else 'N/A' }}</td>
                            <td>{{ data['WBC'][0] if data['WBC'] else 'N/A' }}</td>
                            <td>{{ data['Lymph'][0] if data['Lymph'] else 'N/A' }}</td>
                            <td>{{ data['Neut'][0] if data['Neut'] else 'N/A' }}</td>
                            <td>{{ data['PLT'][0] if data['PLT'] else 'N/A' }}</td>
                            <td>{{ data['EF-TTE'][0] if data['EF-TTE'] else 'N/A' }}</td>
                            <td>{{ data['Region RWMA'][0] if data['Region RWMA'] else 'N/A' }}</td>
                            <td>{{ data['VHD'][0] if data['VHD'] else 'N/A' }}</td>
                            <td>{{ data['Prediction'] if data['Prediction'] else 'N/A' }}</td>
                            <td>{{ data['Prob Cad'] | round(2) if data['Prob Cad'] else 'N/A' }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr><td colspan="50" class="text-center">Tidak ada data pasien.</td></tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Include DataTables JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>

    <script>
        $(document).ready(function() {
            // Initialize DataTables for pagination and search
            $('#patientTable').DataTable({
                "pageLength": 10,  // Set the number of rows per page
                "searching": false,  // Enable search functionality
                "paging": true,  // Enable pagination
                "ordering": true,  // Enable sorting
                "lengthChange": false, // Disable changing rows per page
                "responsive": true // Enable responsive table
            });

            // Filter by fitur (contoh by Prediction)
            document.getElementById('filterSelect').addEventListener('change', function() {
                let filterValue = this.value;
                let table = $('#patientTable').DataTable();
                table.column(49).search(filterValue).draw();  // Perbaikan: Index 49 untuk kolom 'Prediction'
            });
        });
    </script>
</body>
</html>